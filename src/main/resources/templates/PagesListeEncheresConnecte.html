<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Enchères.org</title>
    <link rel="stylesheet" href="css/general.css"/>
    <link
            href="https://fonts.googleapis.com/css2?family=Cal+Sans&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet">
</head>
<body>

<header>
    <nav>
        <div class="titre-entete">
            <a th:if="${session.utilisateurConnecte != null}" th:href="@{/PagesListeEncheresConnecte}">ENI-Enchères</a>
            <span th:unless="${session.utilisateurConnecte != null}">ENI-Enchères</span>
        </div>
        <div class="buttons-nav">
            <div class="button-nav">
                <a th:href="@{/}">Enchères</a>
            </div>
            <div class="button-nav">
                <a th:href="@{'/encheres/creerEnchere'}">Vente article</a>
            </div>
            <div class="button-nav">
                <a th:href="@{'/btnPageMonProfil'}">Mon profil</a>
            </div>
        </div>
        <div class="button-nav">
            <a th:href="@{'/logout'}">Deconnexion</a>
        </div>
    </nav>
</header>

<div class="main-wrapper">

    <h1>Liste des enchères</h1>

    <section class="filtres-container">
        <h2>Filtres :</h2>
        <form method="post" action="/PagesListeEncheresConnecte">
            <input type="search" name="nomArticle" size="30" placeholder="Le nom de l'article contient" th:value="${nomArticle}"> <br><br>
            <label>Catégorie :</label>
            <select name="categorie">
                <option value="" th:selected="${categorieSelectionnee == null or categorieSelectionnee == ''}">-- Toutes les catégories --</option>
                <option value="Informatique" th:selected="${categorieSelectionnee == 'Informatique'}">Informatique</option>
                <option value="Ameublement" th:selected="${categorieSelectionnee == 'Ameublement'}">Ameublement</option>
                <option value="Vêtement" th:selected="${categorieSelectionnee == 'Vêtement'}">Vêtement</option>
                <option value="Sports&Loisirs" th:selected="${categorieSelectionnee == 'Sports&Loisirs'}">Sports&Loisirs</option>
            </select>

            <!-- RADIO BUTTONS ACHATS/VENTES -->
            <section class="RG-AchatVente">
                <label>
                    <input type="radio" name="type" value="achats"
                           th:checked="${filtre == null or filtre.type == null or filtre.type == 'achats'}">
                    Achats
                </label>
                <label>
                    <input type="radio" name="type" value="ventes"
                           th:checked="${filtre != null and filtre.type == 'ventes'}">
                    Mes ventes
                </label>
            </section>

<!--            <section class="RG-AchatVente">-->
<!--                <label><input type="radio" name="type" checked>-->
<!--                    Achats</label>-->
<!--                <label><input type="radio" name="type"> Mes ventes</label>-->
<!--            </section>-->

            <!-- CHECKBOXES CONDITIONNELLES -->
            <section class="AchatVente">
                <!-- CHECKBOXES ACHATS (affichées si type=achats) -->
                <div class="CB-achat" id="checkboxes-achats">
                    <label>
                        <input type="checkbox" name="encheresOuvertes"
                               th:checked="${filtre != null and filtre.encheresOuvertes}">
                        Enchères ouvertes
                    </label>
                    <label>
                        <input type="checkbox" name="mesEncheres"
                               th:checked="${filtre != null and filtre.mesEncheres}">
                        Mes enchères
                    </label>
                    <label>
                        <input type="checkbox" name="encheresRemportees"
                               th:checked="${filtre != null and filtre.encheresRemportees}">
                        Mes enchères remportées
                    </label>
                </div>
                <!-- CHECKBOXES VENTES (affichées si type=ventes) -->
                <div class="CB-Vente" id="checkboxes-ventes" style="display: none;">
                    <label>
                        <input type="checkbox" name="ventesEnCours"
                               th:checked="${filtre != null and filtre.ventesEnCours}">
                        Mes ventes en cours
                    </label>
                    <label>
                        <input type="checkbox" name="ventesNonDebutees"
                               th:checked="${filtre != null and filtre.ventesNonDebutees}">
                        Ventes non débutées
                    </label>
                    <label>
                        <input type="checkbox" name="ventesTerminees"
                               th:checked="${filtre != null and filtre.ventesTerminees}">
                        Ventes terminées
                    </label>
                </div>
            </section>

<!--            <section class="AchatVente">-->
<!--                <div class="CB-achat">-->
<!--                    <label><input type="checkbox"> enchères ouvertes</label>-->
<!--                    <label><input type="checkbox"> mes enchères</label>-->
<!--                    <label><input type="checkbox"> mes enchères remportées</label>-->
<!--                </div>-->
<!--                <div class="CB-Vente">-->
<!--                    <label><input type="checkbox"> mes ventes en cours</label>-->
<!--                    <label><input type="checkbox" checked> ventes non débutées</label>-->
<!--                    <label><input type="checkbox"> ventes terminées</label>-->
<!--                </div>-->
<!--            </section>-->

            <aside class="asideBtn">
                <button type="submit">Rechercher</button>
            </aside>
        </form>
    </section>

    <!-- Utilisation de articleVendu au lieu de article -->
    <section class="detailVente-container" th:each="a : ${articleVendu}">
        <div class="photoArticle-container">
            <!-- Affichage conditionnel des images par catégorie -->
            <img th:if="${a.categorieArticle != null and a.categorieArticle.libelle == 'Informatique'}" th:src="@{/images/informatique.png}" alt="Informatique">
            <img th:if="${a.categorieArticle != null and a.categorieArticle.libelle == 'Ameublement'}" th:src="@{/images/ameublement.png}" alt="Ameublement">
            <img th:if="${a.categorieArticle != null and a.categorieArticle.libelle == 'Vêtement'}" th:src="@{/images/vetement.png}" alt="Vêtement">
            <img th:if="${a.categorieArticle != null and a.categorieArticle.libelle == 'Sports&Loisirs'}" th:src="@{/images/sports.png}" alt="Sports & Loisirs">
            <!-- Image par défaut si pas de catégorie -->
            <img th:if="${a.categorieArticle == null}" th:src="@{/images/logoENI.png}" alt="Article">
        </div>

        <div class="Article-vente-container">
            <!-- Lien vers le détail de l'article -->
            <a th:text="${a.nomArticle}" th:href="@{/encheres/detail(id=${a.idArticle})}"></a>

            <ul>
                <!-- Affichage des vraies données de l'article -->
                <li th:text="${a.nomArticle}">Nom Article</li>
                <li th:text="${a.miseAPrix} + ' €'">Prix Article</li>
                <li th:text="${#temporals.format(a.dateFinEncheres, 'dd/MM/yyyy')}">Fin Enchères</li>
                <li>
                    Vendeur :
                    <!-- Affichage du vrai pseudo du vendeur -->
                    <span th:text="${a.vendeur.pseudo}">Nom du vendeur</span>
                    <!-- <a th:href="@{/PageProfilUtilisateur/{id}(id=${a.vendeur.id})}" th:text="${a.vendeur.pseudo}">Voir profil</a> -->
                </li>
            </ul>
        </div>
    </section>
</div>

<!-- JAVASCRIPT POUR AFFICHER/MASQUER LES CHECKBOXES -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const radioAchats = document.querySelector('input[name="type"][value="achats"]');
        const radioVentes = document.querySelector('input[name="type"][value="ventes"]');
        const checkboxesAchats = document.getElementById('checkboxes-achats');
        const checkboxesVentes = document.getElementById('checkboxes-ventes');
        function toggleCheckboxes() {
            if (radioAchats.checked) {
                checkboxesAchats.style.display = 'block';
                checkboxesVentes.style.display = 'none';
            } else if (radioVentes.checked) {
                checkboxesAchats.style.display = 'none';
                checkboxesVentes.style.display = 'block';
            }
        }
        radioAchats.addEventListener('change', toggleCheckboxes);
        radioVentes.addEventListener('change', toggleCheckboxes);
        // État initial
        toggleCheckboxes();
    });
</script>

</body>
</html>